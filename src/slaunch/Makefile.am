# $Id$
#

AUTOMAKE_OPTIONS = foreign

INCLUDES = -I$(top_srcdir) 

bin_PROGRAMS = slaunch

slaunch_SOURCES = \
	slaunch.c slaunch.h \
	opt.c opt.h \
	srun_job.c  \
	msg.c msg.h \
	pmi.c pmi.h \
	signals.c signals.h \
	launch.c    \
	launch.h    \
	attach.h    \
	attach.c    \
	fname.c     \
	fname.h     \
	sigstr.c    \
	sigstr.h    \
	core-format.c \
	core-format.h \
	multi_prog.c multi_prog.h \
	slaunch.wrapper.c

convenience_libs =  \
	$(top_builddir)/src/common/libcommon.la   \
	$(top_builddir)/src/common/libspank.la   \
	$(top_builddir)/src/common/libeio.la      \
	$(top_builddir)/src/api/libslurm.la

slaunch_LDADD = \
	$(convenience_libs) 

slaunch_LDFLAGS = -export-dynamic $(CMD_LDFLAGS) $(FEDERATION_LDFLAGS)

force:
$(convenience_libs) : force
	@cd `dirname $@` && $(MAKE) `basename $@`

attach.o : attach.c
	$(COMPILE) -c -g -o attach.o $(srcdir)/attach.c 

install-exec-local:
	umask 022; \
	if [ -x /usr/lib/rpm/debugedit ]; then \
	  srcdir=`cd $(top_srcdir) && pwd`; \
	  /usr/lib/rpm/debugedit -b $$srcdir -d $(pkglibdir) \
	                         $(DESTDIR)$(bindir)/slaunch; fi; \
	$(INSTALL) -D -m 644 $(top_srcdir)/src/slaunch/slaunch.wrapper.c \
	                       $(DESTDIR)$(pkglibdir)/src/slaunch/slaunch.wrapper.c

