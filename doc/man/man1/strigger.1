.TH SCONTROL "1" "March 2007" "strigger 1.2" "Slurm components"

.SH "NAME"
strigger \- Used set, get or clear Slurm trigger information.

.SH "SYNOPSIS"
\fBstrigger --set\fR   [\fIOPTIONS\fR...]
.TP
\fBstrigger --get\fR   [\fIOPTIONS\fR...]
.TP
\fBstrigger --clear\fR [\fIOPTIONS\fR...]

.SH "DESCRIPTION"
\fBstrigger\fR is used to set, get or clear Slurm trigger information.
Triggers include events such as a node failing, a job reaching its 
time limit or a job terminating.
These events can cause actions such as the execution of an arbitrary 
script. 
Typical uses include notifying system administrators of node failures 
and gracefully terminating a job when it's time limit is approaching.

.SH "ARGUMENTS"
.TP
\fB\-\-clear\fP
Clear or delete a previously defined event trigger.
The \fB\-\-id\fR, \fB\-\-jobid\fR or \fB\-\-userid\fR
option must be specified to identify the trigger(s) to 
be cleared.

.TP
\fB\-d\fR, \fB\-\-down\fR
Trigger an event if the specified node goes into a DOWN state.

.TP
\fB\-f\fR, \fB\-\-fini\fR
Trigger an event when the specified job completes execution.

.TP
\fB\-\-get\fP
Show registered event triggers.
Options can be used for filtering purposes.

.TP
\fB\-i\fR, \fB\-\-id\fR=\fIid\fR
Trigger ID number.

.TP
\fB\-j\fR, \fB\-\-jobid\fR=\fIid\fR
Job ID of interest.
\fBNOTE:\fR The \fB\-\-jobid\fR option can not be used in conjunction 
with the \fB\-\-node\fR option. When the \fB\-\-jobid\fR option is 
used in conjunction with the \fB\-\-up\fR or \fB\-\-down\fR option, 
all nodes allocated to that job will considered the nodes used as a 
trigger event.

.TP
\fB\-n\fR, \fB\-\-node\fR[=\fIhost\fR]
Host name(s) of interest. 
By default, all nodes associated with the job (if \fB\-\-jobid\fR 
is specified) or on the system are considered for event triggers.
\fBNOTE:\fR The \fB\-\-node\fR option can not be used in conjunction 
with the \fB\-\-jobid\fR option. When the \fB\-\-jobid\fR option is 
used in conjunction with the \fB\-\-up\fR or \fB\-\-down\fR option, 
all nodes allocated to that job will considered the nodes used as a 
trigger event.

.TP
\fB\-o\fR, \fB\-\-offset\fR=\fIseconds\fR
The specified action should follow the event by this time interval.
Specify a negative value if action should preceded the event.
The default value is zero if no \fB\-\-offset\fR option is specified.
The resolution of this time is about 20 seconds, so to execute 
a script not less than five minutes prior to a job reaching its 
time limit, specify \fB\-\-offset=320\fR (5 minutes plus 20 seconds).

.TP
\fB\-p\fR, \fB\-\-program\fR=\fIpath\fR
Execute the program at the specified fully qualified pathname
when the event occurs.
The program will be executed as the user who sets the trigger.
If the program fails to terminate within 5 minutes, it will 
be killed along with any spawned processes.

.TP
\fB\-q\fR, \fB\-\-quiet\fR
Do not report non\-fatal errors. 
This can be useful to clear triggers which may have already been purged.

.TP
\fB\-r\fR, \fB\-\-reconfig\fR
Trigger an event when the system configuration changes.

.TP
\fB\-\-set\fP
Register an event trigger based upon the supplied options.
NOTE: An event is only triggered once. A new event trigger 
must be set established for future events of the same type 
to be processed. 

.TP
\fB\-t\fR, \fB\-\-time\fR
Trigger an event when the specified job's time limit is reached.
This must be used in conjunction with the \fB\-\-jobid\fR option.

.TP
\fB\-u\fR, \fB\-\-up\fR
Trigger an event if the specified node is returned to service
from a DOWN state.

.TP
\fB\-\-user\fR=\fIuser_name_or_id\fR
Clear or get triggers associated with the specified user.
Specify either a user name or user ID.

.TP
\fB\-v\fR, \fB\-\-verbose\fR
Print detailed event logging. This includes time\-stamps on data structures, 
record counts, etc.

.TP
\fB\-V\fR , \fB\-\-version\fR
Print version information and exit.

.SH "OUTPUT FIELD DESCRIPTIONS"
.TP
\fBTRIG_ID\fP
Trigger ID number.

.TP
\fBRES_TYPE\fP
Resource type: \fIjob\fR or \fInode\fR

.TP
\fBRES_ID\fP
Resource ID: job ID or host names or "*" for any host

.TP
\fBTYPE\fP
Trigger type: \fItime\fR or \fIfini\R (for jobs only), 
\fIdown\fR or \fIup\fR (for jobs or nodes), or
\fIreconfig\fR (for nodes only)

.TP
\fBOFFSET\fP
Time offset in seconds. Negative numbers indicated the action should 
occur before the event (if possible)

.TP
\fBUSER\fP
Name of the user requesting the action

.TP
\fBPROGRAM\fP
Pathname of the program to execute when the event occurs

.SH "EXAMPLES"
Execute the program "/usr/sbin/slurm_admin_notify" whenever 
any node in the cluster goes down. 

.nf
	> cat /usr/sbin/slurm_admin_notify
	#!/bin/bash
	# Submit trigger for next event
	strigger --set --node --down \\
	         --program=/usr/sbin/slurm_admin_notify
	# Notify administrator using by e-mail
	/bin/mail slurm_admin@site.com -s NodeDown

	> strigger --set --node --down \\
	           --program=/usr/sbin/slurm_admin_notify
.fi

.PP
Execute the program "/home/joe/clean_up" when job 1234 is within 
10 minutes of reaching its time limit.

.nf
	> strigger --set --jobid=1234 --time --offset=-600 \\
	           --program=/home/joe/clean_up
.fi

.PP
Execute the program "/home/joe/node_died" when any node allocated to
job 1234 enters the DOWN state.

.nf
	> strigger --set --jobid=1234 --down \\
	           --program=/home/joe/node_died
.fi

.PP
Show all triggers associated with job 1235.

.nf
	> strigger --get --jobid=1235
	TRIG_ID RES_TYPE RES_ID TYPE OFFSET USER PROGRAM
	    123      job   1235 time   -600  joe /home/bob/clean_up
	    125      job   1235 down      0  joe /home/bob/node_died
.fi

.PP
Delete event trigger 125.

.fp
	> strigger --clear --id=125
.fi

.PP
Execute /home/joe/job_fini upon completion of job 1237.

.fp
	> strigger --set --jobid=1237 --fini --program=/home/joe/job_fini
.fi

.SH "COPYING"
Copyright (C) 2007 The Regents of the University of California.
Produced at Lawrence Livermore National Laboratory (cf, DISCLAIMER).
UCRL\-CODE\-226842.
.LP
This file is part of SLURM, a resource management program.
For details, see <http://www.llnl.gov/linux/slurm/>.
.LP
SLURM is free software; you can redistribute it and/or modify it under
the terms of the GNU General Public License as published by the Free
Software Foundation; either version 2 of the License, or (at your option)
any later version.
.LP
SLURM is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more
details.

.SH "SEE ALSO"
\fBscontrol\fR(1), \fBsinfo\fR(1), \fBsqueue\fR(1)

