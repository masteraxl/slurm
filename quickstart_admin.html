<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
                        "http://www.w3.org/TR/REC-html40/loose.dtd">

<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="keywords" content="Simple Linux Utility for Resource Management, SLURM, resource management, 
Linux clusters, high-performance computing, Livermore Computing">
<meta name="LLNLRandR" content="UCRL-WEB-204324">
<meta name="LLNLRandRdate" content="15 October 2004">
<meta name="distribution" content="global">
<meta name="description" content="Simple Linux Utility for Resource Management">
<meta name="copyright"
content="This document is copyrighted U.S.
Department of Energy under Contract W-7405-Eng-48">
<meta name="Author" content="Morris Jette">
<meta name="email" content="jette1@llnl.gov">
<meta name="Classification"
content="DOE:DOE Web sites via organizational
structure:Laboratories and Other Field Facilities">
<title>Simple Linux Utility for Resource Management:Quick Start Administrator Guide</title>
<link href="slurmstyles.css" rel="stylesheet" type="text/css">
</head>

<body bgcolor="#000000" text="#000000" leftmargin="0" topmargin="0">
<table width="770" border="0" cellspacing="0" cellpadding="0">
<tr> 
<td><img src="slurm_banner.jpg" width="770" height="145" usemap="#Map" border="0" alt="Simple Linux Utility for Resource Management"></td>
</tr>
</table>
<table width="770" border="0" cellspacing="0" cellpadding="3" bgcolor="#FFFFFF">
<tr> 
<td width="100%"> 
<table width="760" border="0" cellspacing="0" cellpadding="4" align="right">
<tr>
<td valign="top" bgcolor="#000000"><p><img src="spacer.gif" width="110" height="1" alt=""></p>
<p><a href="slurm.html" class="nav" align="center">Home</a></p>
<p><span class="whitetext">About</span><br>
<a href="overview.html" class="nav">Overview</a><br>
<a href="news.html" class="nav">What's New</a><br>
<a href="publications.html" class="nav">Publications</a><br>
<a href="team.html" class="nav">SLURM Team</a></p>
<p><span class="whitetext">Using</span><br>
<a href="documentation.html" class="nav">Documentation</a><br>
<a href="faq.html" class="nav">FAQ</a><br>
<a href="help.html" class="nav">Getting Help</a></p>
<p><span class="whitetext">Installing</span><br>
<a href="platforms.html" class="nav">Platforms</a><br>
<a href="download.html" class="nav">Download</a><br>
<a href="quickstart_admin.html" class="nav">Guide</a></p></td>
<td><img src="spacer.gif" width="10" height="1" alt=""></td>
<td valign="top"><h2>Quick Start Administrator Guide</h2>
<h3>Overview</h3>
Please see the <a href="quickstart.html">Quick Start User Guide</a> for a general 
overview. 
 
<h3>Building and Installing</h3>
<p>Basic instructions to build and install SLURM from source are shown below. 
See the README and INSTALL files in the source distribution for more details. 
</p>
<ol>
<li><span class="commandline">cd</span> to the directory containing the SLURM 
source and type <i>.</i><span class="commandline">/configure</span> with appropriate 
options.</li>
<li>Type <span class="commandline">make</span> to compile SLURM.</li>
<li> Type <span class="commandline">make install</span> to install the programs, 
documentation, libaries, header files, etc.</li>
</ol>
<p>The most commonly used arguments to the <span class="commandline">configure</span> 
command include: </p>
<p style="margin-left:.2in"><span class="commandline">--enable-debug</span><br>
Enable debugging of individual modules.</p>
<p style="margin-left:.2in"><span class="commandline">--prefix=<i>PREFIX</i></span><br>
</i> 
Install architecture-independent files in PREFIX; default value is /usr/local.</p>
<p style="margin-left:.2in"><span class="commandline">--sysconfdir=<i>DIR</i></span><br>
</i> 
Specify location of SLURM configuration file.</p>
<p>Optional SLURM plugins will be built automatically when the
<span class="commandline">configure</span> script detects that the required 
build requirements are present. Build dependencies for various plugins
are denoted below.
</p>
<ul>
<li> <b>Munge</b> The auth/munge plugin will be built if Chris Dunlap's Munge
                  library is installed. </li>
<li> <b>Authd</b> The auth/authd plugin will be built and installed if 
                  the libauth library and its dependency libe are installed. 
		  </li>
<li> <b>QsNet</b> QsNet support in the form of the switch/elan plugin requires
                  that the qsnetlibs package (from Quadrics) be installed along
		  with its development counterpart (i.e. the qsnetheaders
		  package.) The switch/elan plugin also requires the 
		  presence of the libelanosts library and /etc/elanhosts
		  configuration file. (See elanhosts(5) man page in that
		  package for more details)
</ul>
Please see the <a href=download.html>Download</a> page for references to
required software to build these plugins.
<p class="footer"><a href="#top">top</a></p>

<h3>Daemons</h3>
<p><b>slurmctld</b> is sometimes called the &quot;controller&quot; daemon. It 
orchestrates SLURM activities, including queuing of job, monitoring node state, 
and allocating resources (nodes) to jobs. There is an optional backup controller 
that automatically assumes control in the event the primary controller fails. 
The primary controller resumes control whenever it is restored to service. The 
controller saves its state to disk whenever there is a change. This state can 
be recovered by the controller at startup time. <b>slurmctld</b> would typically 
execute as a special user specifically for this purpose (not user root). State 
changes are saved so that jobs and other state can be preserved when slurmctld 
moves or is restarted.</p>
<p>The <b>slurmd</b> daemon executes on every compute node. It resembles a remote 
shell daemon to export control to SLURM. Because slurmd initiates and manages 
user jobs, it must execute as the user root.</p>
<p><b>slurmctld</b> and/or <b>slurmd</b> should be initiated at node startup time 
per the SLURM configuration.</p>

<h3>Infrastructure</h3>
<h4>Authentication of SLURM communications</h4>
<p>All communications between SLURM components are authenticated. The 
authentication infrastructure is provided by a dynamically loaded
plugin chosen at runtame via the <b>AuthType</b> keyword in the SLURM 
configuration file.  Currently available authentication types include
<a href="http://www.theether.org/authd/">authd</a>, 
<a href="ftp://ftp.llnl.gov/pub/linux/munge/">munge</a>, and none.
The default authentication infrastructure is "none". This permits any user to execute 
any job as another user. This may be fine for testing purposes, but certainly not for production 
use. <b>Configure some AuthType value other than "none" if you want any security.</b>
We recommend the use of Munge unless you are experienced with authd.
</p>
<p>While SLURM itself does not rely upon synchronized clocks on all nodes
of a cluster for proper operation, its underlying authentication mechanism 
may have this requirement. For instance, if SLURM is making use of the
auth/munge plugin for communication, the clocks on all nodes will need to 
be synchronized. </p>

<h4>MPI support</h4>
<p>Quadrics MPI works directly with SLURM on systems having Quadrics interconnects. 
For non-Quadrics interconnect systems, <a href="http://www.lam-mpi.org/">LAM/MPI</a> 
is the preferred MPI infrastructure. LAM/MPI uses the command <i>lamboot</i> to 
initiate job-specific daemons on each node using SLURM's 
<span class="commandline">srun</span> 
command. This places all MPI processes in a process-tree under the control of 
the <b>slurmd</b> daemon. LAM/MPI version 7.1 or higher contains support for 
SLURM.</p>

<p>In order to use MPICH-GM, set the <b>MpichGmDirectSupport</b> and <b>KillTree</b> 
configuration parameters.</p>

<p>Note that the ordering of tasks within an job's allocation matches that of 
nodes in the slurm.conf configuration file. SLURM presently lacks the ability 
to arbitrarily order tasks across nodes.</p> 

<h4>Scheduler support</h4>
<p>The scheduler used by SLURM is controled by the <b>SchedType</b> configuration 
parameter. This is meant to control the relative importance of pending jobs.
SLURM's default scheduler is FIFO (First-In First-Out). A backfill scheduler 
plugin is also available. Backfill scheduling will initiate a lower-priority job 
if doing so does not delay the expected initiation time of higher priority jobs; 
essentially using smaller jobs to fill holes in the resource allocation plan. 
SLURM also supports a plugin for use of <a href="http://supercluster.org/maui">
The Maui Scheduler</a>, which offers sophisticated scheduling algorithms. 
Motivated users can even develop their own scheduler plugin if so desired. </p>

<p>SLURM also has a plugin to control the node selection algorithm for jobs.
This is controlled by the <b>SelectType</b> configuration parameter.
The two available options are <i>linear</i>, to support a flat interconnect, 
and <i>bluegene</i> to support Blue Gene systems with a three-dimensional 
topography.</p>

<h4>Logging</h4>
<p>SLURM uses the syslog function to record events. It uses a range of importance
levels for these messages. Be certain that your system's syslog functionality
is operational. </p>

<h4>Corefile format</h4>
<p>SLURM is designed to support generating a variety of core file formats for 
application codes that fail (see the <i>--core</i> option of the <i>srun</i>
command).  As of now, SLURM only supports a locally developed lightweight
corefile library which has not yet been released to the public. It is 
expected that this library will be available in the near future. </p>

<h4>Parallel debugger support</h4>
<p>SLURM exports information for parallel debuggers using the specification
detailed  <a href=http://www-unix.mcs.anl.gov/mpi/mpi-debug/mpich-attach.txt>here</a>.
This is meant to be exploited by any parallel debugger (notably, TotalView),
and support is unconditionally compiled into SLURM code. 
</p>
<p>We use a patched version of TotalView that looks for a "totalview_jobid" 
symbol in <b>srun</b> that it then uses (configurably) to perform a bulk 
launch of the <b>tvdsvr</b> daemons via a subsequent <b>srun</b>. Otherwise
it is difficult to get TotalView to use <b>srun</b> for a bulk launch, since 
<b>srun</b> will be unable to determine for which job it is launching tasks.
</p>
<p>Another solution would be to run TotalView within an existing <b>srun</b>
<i>--allocate</i> session. Then the Totalview bulk launch command to <b>srun</b>
could be set to ensure only a single task per node. This functions properly 
because the SLRUM_JOBID environment variable is set in the allocation shell 
environment.
</p>

<p class="footer"><a href="#top">top</a></p>

<h3>Configuration</h3>
<p>The SLURM configuration file includes a wide variety of parameters. 
This configuration file must be available on each node of the cluster. A full
description of the parameters is included in the slurm.conf man page. Rather than 
duplicate that information, a sample configuration file is shown below. Any text 
following a &quot;#&quot; is considered a comment. The keywords in the file are 
not case sensitive, although the argument typically is (e.g., &quot;SlurmUser=slurm&quot; 
might be specified as &quot;slurmuser=slurm&quot;). The control machine, like 
all other machine specifications, can include both the host name and the name 
used for communications. In this case, the host's name is &quot;mcri&quot; and 
the name &quot;emcri&quot; is used for communications. The &quot;e&quot; prefix 
identifies this as an ethernet address at this site. Port numbers to be used for 
communications are specified as well as various timer values.</p>
<p>A description of the nodes and their grouping into non-overlapping partitions 
is required. Partition and node specifications use node range expressions to identify 
nodes in a concise fashion. This configuration file defines a 1154-node cluster 
for SLURM, but it might be used for a much larger cluster by just changing a few 
node range expressions. Specify the minimum processor count (Procs), real memory 
space (RealMemory, megabytes), and temporary disk space (TmpDisk, megabytes) that 
a node should have to be considered available for use. Any node lacking these 
minimum configuration values will be considered DOWN and not scheduled.</p>
<pre>
# 
# Sample /etc/slurm.conf for mcr.llnl.gov
#
ControlMachine=mcri   ControlAddr=emcri
BackupMachine=mcrj    BackupAddr=emcrj 
#
AuthType=auth/munge
Epilog=/usr/local/slurm/etc/epilog
FastSchedule=1
JobCompLoc=/var/tmp/jette/slurm.job.log
JobCompType=jobcomp/filetxt
JobCredentialPrivateKey=/usr/local/etc/slurm.key
JobCredentialPublicCertificate=/usr/local/etc/slurm.cert
PluginDir=/usr/local/slurm/lib/slurm
Prolog=/usr/local/slurm/etc/prolog
SchedulerType=sched/backfill
SelectType=select/linear
SlurmUser=slurm
SlurmctldPort=7002
SlurmctldTimeout=300
SlurmdPort=7003
SlurmdSpoolDir=/var/tmp/slurmd.spool
SlurmdTimeout=300
StateSaveLocation=/tmp/slurm.state
SwitchType=switch/elan
#
# Node Configurations
#
NodeName=DEFAULT Procs=2 RealMemory=2000 TmpDisk=64000 State=UNKNOWN
NodeName=mcr[0-1151] NodeAddr=emcr[0-1151]
#
# Partition Configurations
#
PartitionName=DEFAULT State=UP    
PartitionName=pdebug Nodes=mcr[0-191] MaxTime=30 MaxNodes=32 Default=YES
PartitionName=pbatch Nodes=mcr[192-1151]
</pre> 
<h3>Security</h3>
<p>You will should create unique job credential keys for your site
using the program <a href="http://www.openssl.org/">openssl</a>. 
<b>You must use openssl and not ssh-genkey to construct these keys.</b>
An example of how to do this is shown below. Specify file names that 
match the values of JobCredentialPrivateKey and JobCredentialPublicCertificate 
in your configuration file. The JobCredentialPrivateKey 
file must be readable only by SlurmUser. The JobCredentialPublicCertificate file 
must be readable by all users. 
Both files must be available on all nodes in the cluster. </p>
<p class="commandline" style="margin-left:.2in">openssl genrsa -out /usr/local/etc/slurm.key 
1024<br>
openssl rsa -in /usr/local/etc/slurm.key -pubout -out /usr/local/etc/slurm.cert 
</p>
<p>SLURM does not use reserved ports to authenticate communication between components. 
You will need to have at least one &quot;auth&quot; plugin. Currently, only three 
authentication plugins are supported: <b>auth/none</b>, <b>auth/authd</b>, and 
<b>auth/munge</b>. The auth/none plugin is built and used by default, but either 
Brent Chun's <a href="http://www.theether.org/authd/">authd</a>, or Chris Dunlap's 
<a href="ftp://ftp.llnl.gov/pub/linux/munge/">munge</a> should be installed in order to 
get properly authenticated communications. 
Unless you are experience with authd, we recommend the use of munge.
The configure script in the top-level directory of this distribution will determine 
which authentication plugins may be built. The configuration file specifies which 
of the available plugins will be utilized. </p>
<p>A PAM module (Pluggable Authentication Module) is available for SLURM that 
can prevent a user from accessing a node which he has not been allocated, if that 
mode of operation is desired.</p>
<p class="footer"><a href="#top">top</a></p>

<h3>Starting the Daemons</h3>
<p>For testing purposes you may want to start by just running slurmctld and slurmd 
on one node. By default, they execute in the background. Use the <span class="commandline">-D</span> 
option for each daemon to execute them in the foreground and logging will be done 
to your terminal. The <span class="commandline">-v</span> option will log events 
in more detail with more v's increasing the level of detail (e.g. <span class="commandline">-vvvvvv</span>). 
You can use one window to execute <span class="commandline">slurmctld -D -vvvvvv</span>, 
a second window to execute <span class="commandline">slurmd -D -vvvvv</span>, 
and a third window to execute commands such as <span class="commandline">srun 
-N1 /bin/hostname</span> to confirm basic functionality.</p>
<p>Another important option for the daemons is <span class="commandline">-c</span> 
to clear previous state information. Without the <span class="commandline">-c</span> 
option, the daemons will restore any previously saved state information: node 
state, job state, etc. With the <span class="commandline">-c</span> option all 
previously running jobs will be purged and node state will be restored to the 
values specified in the configuration file. This means that a node configured 
down manually using the <span class="commandline">scontrol</span> command will 
be returned to service unless also noted as being down in the configuration file. 
In practice, SLURM restarts with preservation consistently.</p>
<p>A thorough battery of tests written in the &quot;expect&quot; language is also 
available. </p>
<p class="footer"><a href="#top">top</a></p>

<h3>Administration Examples</h3>
<p><span class="commandline">scontrol</span> can be used to print all system information 
and modify most of it. Only a few examples are shown below. Please see the scontrol 
man page for full details. The commands and options are all case insensitive.</p>
<p>Print detailed state of all jobs in the system.</p>
<pre>
adev0: scontrol
scontrol: show job
JobId=475 UserId=bob(6885) Name=sleep JobState=COMPLETED
   Priority=4294901286 Partition=batch BatchFlag=0
   AllocNode:Sid=adevi:21432 TimeLimit=UNLIMITED
   StartTime=03/19-12:53:41 EndTime=03/19-12:53:59
   NodeList=adev8 NodeListIndecies=-1
   ReqProcs=0 MinNodes=0 Shared=0 Contiguous=0
   MinProcs=0 MinMemory=0 Features=(null) MinTmpDisk=0
   ReqNodeList=(null) ReqNodeListIndecies=-1

JobId=476 UserId=bob(6885) Name=sleep JobState=RUNNING
   Priority=4294901285 Partition=batch BatchFlag=0
   AllocNode:Sid=adevi:21432 TimeLimit=UNLIMITED
   StartTime=03/19-12:54:01 EndTime=NONE
   NodeList=adev8 NodeListIndecies=8,8,-1
   ReqProcs=0 MinNodes=0 Shared=0 Contiguous=0
   MinProcs=0 MinMemory=0 Features=(null) MinTmpDisk=0
   ReqNodeList=(null) ReqNodeListIndecies=-1
</pre> <p>Print the detailed state of job 477 and change its priority to 
zero. A priority of zero prevents a job from being initiated (it is held in &quot;pending&quot; 
state).</p>
<pre>
adev0: scontrol
scontrol: show job 477
JobId=477 UserId=bob(6885) Name=sleep JobState=PENDING
   Priority=4294901286 Partition=batch BatchFlag=0
   <i>more data removed....</i>
scontrol: update JobId=477 Priority=0
</pre> 
<p class="footer"><a href="#top">top</a></p>
<p>Print the state of node adev13 and drain it. To drain a node specify a new 
state of DRAIN, DRAINED, or DRAINING. SLURM will automatically set it to the appropriate 
value of either DRAINING or DRAINED depending on whether the node is allocated 
or not. Return it to service later.</p>
<pre>
adev0: scontrol
scontrol: show node adev13
NodeName=adev13 State=ALLOCATED CPUs=2 RealMemory=3448 TmpDisk=32000
   Weight=16 Partition=debug Features=(null) 
scontrol: update NodeName=adev13 State=DRAIN
scontrol: show node adev13
NodeName=adev13 State=DRAINING CPUs=2 RealMemory=3448 TmpDisk=32000
   Weight=16 Partition=debug Features=(null) 
scontrol: quit
<i>Later</i>
adev0: scontrol 
scontrol: show node adev13
NodeName=adev13 State=DRAINED CPUs=2 RealMemory=3448 TmpDisk=32000
   Weight=16 Partition=debug Features=(null) 
scontrol: update NodeName=adev13 State=IDLE
</pre> <p>Reconfigure all SLURM daemons on all nodes. This should 
be done after changing the SLURM configuration file.</p>
<pre>
adev0: scontrol reconfig
</pre> <p>Print the current SLURM configuration. This also reports if the 
primary and secondary controllers (slurmctld daemons) are responding. To just 
see the state of the controllers, use the command <span class="commandline">ping</span>.</p>
<pre>
adev0: scontrol show config
Configuration data as of 03/19-13:04:12
AuthType          = auth/munge
BackupAddr        = eadevj
BackupController  = adevj
ControlAddr       = eadevi
ControlMachine    = adevi
Epilog            = (null)
FastSchedule      = 1
FirstJobId        = 1
HeartbeatInterval = 60
InactiveLimit     = 0
JobCompLoc        = /var/tmp/jette/slurm.job.log
JobCompType       = jobcomp/filetxt
JobCredPrivateKey = /etc/slurm/slurm.key
JobCredPublicKey  = /etc/slurm/slurm.cert
KillWait          = 30
MaxJobCnt         = 2000
MinJobAge         = 300
PluginDir         = /usr/lib/slurm
Prolog            = (null)
ReturnToService   = 1
SchedulerAuth     = (null)
SchedulerPort     = 65534
SchedulerType     = sched/backfill
SlurmUser         = slurm(97)
SlurmctldDebug    = 4
SlurmctldLogFile  = /tmp/slurmctld.log
SlurmctldPidFile  = /tmp/slurmctld.pid
SlurmctldPort     = 7002 
SlurmctldTimeout  = 300
SlurmdDebug       = 65534
SlurmdLogFile     = /tmp/slurmd.log
SlurmdPidFile     = /tmp/slurmd.pid
SlurmdPort        = 7003
SlurmdSpoolDir    = /tmp/slurmd
SlurmdTimeout     = 300
SLURM_CONFIG_FILE = /etc/slurm/slurm.conf
StateSaveLocation = /usr/local/tmp/slurm/adev
SwitchType        = switch/elan
TmpFS             = /tmp
WaitTime          = 0

Slurmctld(primary/backup) at adevi/adevj are UP/UP
</pre> <p>Shutdown all SLURM daemons on all nodes.</p>
<pre>
adev0: scontrol shutdown
</pre> <p class="footer"><a href="#top">top</a></p>

<h3>Upgrades</h3>
<p>When upgrading to a new major or minor release of SLURM (e.g. 0.3.x to 0.4.x) 
all running and pending jobs will be purged due to changes in state save 
information. It is possible to develop software to translate state information 
between versions, but we do not normally expect to do so.
When upgrading to a new micro release of SLURM (e.g. 0.3.1 to 0.3.2) all
running and pending jobs will be preserved. Just install a new version of
SLURM and restart the daemons.
An exception to this is that jobs may be lost when installing new pre-release 
versions (e.g. 0.4.0-pre1 to 0.4.0-pre2). We'll try to note these cases 
in the NEWS file.

</pre> <p class="footer"><a href="#top">top</a></p></td>

</tr>
<tr> 
<td colspan="3"><hr> <p>For information about this page, contact <a href="mailto:slurm-dev@lists.llnl.gov">slurm-dev@lists.llnl.gov</a>.</p>
<p><a href="http://www.llnl.gov/"><img align=middle src="lll.gif" width="32" height="32" border="0"></a></p>
<p class="footer">UCRL-WEB-207187<br>
Last modified 15 October 2004</p></td>
</tr>
</table>
</td>
 </tr>
</table>
<map name="Map">
<area shape="rect" coords="616,4,762,97" href="../">
<area shape="rect" coords="330,1,468,11" href="http://www.llnl.gov/disclaimer.html">
<area shape="rect" coords="11,23,213,115" href="slurm.html">
</map>
</body>
</html>
